# 🛡️ NapCat 群管插件 (napcat-plugin-group-manager)

**napcat-plugin-group-manager** 是一款专为 NapCat (OneBot 11) 设计的轻量级、功能全面的群组管理插件。集成了**入群欢迎**、**违禁词过滤**、**群名片锁定**、**针对模式**以及**黑白名单管理**等实用功能。

## ✨ 主要功能

* **📋 群组名单控制**：精准控制插件在哪些群生效（白名单模式）或在哪些群禁用（黑名单模式）。
* **🔒 群名片锁定 (名片管家)**：
    * **强力锁定**：管理员可强制锁定成员名片，成员无法自行修改。
    * **自我锁定**：成员可锁定自己的名片，防止误触修改。
    * **防篡改机制**：监测到名片变更（或成员发言时）自动检测并回退到锁定状态。
    * **入群自动修改**：被锁定的用户退群重进后，自动恢复锁定名片。
* **🎯 针对模式**：管理员可将指定成员加入“针对列表”，该成员在群内的任何发言都会被**立即撤回**，实现“软禁言”效果。
* **👋 入群欢迎**：新成员进群时自动发送自定义欢迎语，支持 @ 成员。
* **🚫 违禁词过滤**：实时监控群消息，检测到敏感词自动撤回，并可配置自动禁言或踢出。
* **⚡ 管理员命令**：快捷指令执行踢人、禁言、全员禁言等操作。

---

## 📁 项目结构

napcat-plugin-group-manager/
├── package.json
├── dist/
│   └── index.mjs    # 构建产物
└── src/
├── index.ts     # 入口
├── config.ts    # 配置管理
├── handlers.ts  # 业务逻辑
└── types.ts     # 类型定义

---

## 📥 安装与部署

1. 构建插件
   在项目根目录执行：
   npm install
   npm run build
   构建成功后，dist 目录下会生成 index.mjs。

2. 安装到 NapCat
   将 package.json 和 dist 文件夹复制到 NapCat 的 plugins/napcat-plugin-group-manager/ 目录下。

3. 重启 NapCat
   重启后即可在 WebUI 中看到插件配置。

---

## ⚙️ 配置说明 (WebUI)

请在 NapCat WebUI 的 插件管理 -> NapCat 群管插件 中进行配置。

### 1. 👑 主人设置
- **主人QQ**：拥有最高权限的 QQ 号列表，多个 QQ 用英文逗号 , 分隔。主人可忽略管理员权限直接使用所有指令。

### 2. 📋 群组名单控制
- **名单模式**：不启用（插件在所有群生效）、黑名单（在列表中禁用）、白名单（仅在列表中启用）。
- **群号列表**：多个群号使用英文逗号 , 分隔。

### 3. 👋 入群欢迎
- **启用入群欢迎**：开关。
- **欢迎语模板**：支持变量 {nickname} (昵称/名片) 和 {user_id} (QQ号)。

### 4. 🚫 违禁词过滤
- **违禁词列表**：使用竖线 | 分隔，例如 兼职|刷单|加群。
- **触发惩罚**：仅撤回 / 撤回+禁言1分钟 / 撤回+踢出。

---

## 💻 指令列表

### 🎯 针对指令 (管理员专用)
此类指令不需要 / 前缀。
- **针对 @成员 / 针对 QQ号**：将目标加入针对列表，开启消息秒撤回。
- **取消针对 @成员 / 取消针对 QQ号**：将目标移出针对列表。
- **针对列表**：查看当前群内所有被针对的用户 QQ。

### 🔒 群名片锁定指令
- **/lockname @成员 昵称**：管理员强制修改并锁定他人名片。
- **/lockname 昵称**：锁定自己的名片（若已被管理员锁定则无效）。
- **/unlockname @成员**：管理员解除对他人的名片锁定。
- **/unlockname**：解除自己的名片锁定。

### ⚡ 常规管理指令 (仅管理员)
- **/kick @成员**：踢出群成员。
- **/ban @成员 [秒数]**：禁言指定成员（默认 600秒）。
- **/unban @成员**：解除禁言。
- **/muteall**：开启全员禁言。
- **/unmuteall**：关闭全员禁言。

---

## ❓ 常见问题
- **Q: 为什么修改了名片没有立即变回来？**
  A: 本插件采用双重检测：监听变更事件及发言检测。成员修改名片后一旦发言，会立即被检测并改回。
- **Q: 配置文件在哪里？**
  A: 默认保存在 NapCat 的 data/config.json 或插件目录下的 config.json 中。

---

## 📝 开发信息
- 版本: 1.2.0
- 语言: TypeScript