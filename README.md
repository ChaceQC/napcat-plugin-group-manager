# 🛡️ NapCat 群管插件 (napcat-plugin-group-manager)

**napcat-plugin-group-manager** 是一款专为 NapCat (OneBot 11) 设计的轻量级、功能全面的群组管理插件。集成了**入群欢迎**、**违禁词过滤**、**群名片锁定**以及**黑白名单管理**等实用功能。

## ✨ 主要功能

* **📋 群组黑白名单**：精准控制插件在哪些群生效（白名单模式）或在哪些群禁用（黑名单模式）。
* **🔒 群名片锁定 (名片管家)**：
    * **强力锁定**：管理员可强制锁定成员名片，成员无法自行修改。
    * **自我锁定**：成员可锁定自己的名片，防止误触修改。
    * **防篡改机制**：监测到名片变更（或成员发言时）自动检测并回退到锁定状态。
    * **入群自动修改**：被锁定的用户退群重进后，自动恢复锁定名片。
* **👋 入群欢迎**：新成员进群时自动发送自定义欢迎语，支持 `@` 成员。
* **🚫 违禁词过滤**：实时监控群消息，检测到敏感词自动撤回，并可配置自动禁言或踢出。
* **⚡ 管理员命令**：快捷指令执行踢人、禁言、全员禁言等操作。

---

## 📁 项目结构

```text
napcat-plugin-group-manager/
├── package.json
├── dist/
│   └── index.mjs    # 构建产物
└── src/
    ├── index.ts     # 入口
    ├── config.ts    # 配置管理
    ├── handlers.ts  # 业务逻辑
    └── types.ts     # 类型定义
```

---

## 📥 安装与部署

1.  **构建插件**
    在项目根目录执行：
    ```bash
    npm install
    npm run build
    ```
    构建成功后，`dist` 目录下会生成 `index.mjs`。

2.  **安装到 NapCat**
    将 `package.json` 和 `dist` 文件夹复制到 NapCat 的 `plugins/napcat-plugin-group-manager/` 目录下。

3.  **重启 NapCat**
    重启后即可在 WebUI 中看到插件配置。

---

## ⚙️ 配置说明 (WebUI)

请在 NapCat WebUI 的 **插件管理** -> **NapCat 群管插件** 中进行配置。

### 1. 📋 群组名单控制
控制插件的生效范围。

| 配置项 | 说明 |
| :--- | :--- |
| **名单模式** | **不启用**：插件在所有群生效。<br>**黑名单**：在“群号列表”中的群**禁用**插件。<br>**白名单**：**仅**在“群号列表”中的群**启用**插件。 |
| **群号列表** | 多个群号使用英文逗号 `,` 分隔。 |

### 2. 👋 入群欢迎
| 配置项 | 说明 |
| :--- | :--- |
| **启用入群欢迎** | 开关。 |
| **欢迎语模板** | 支持变量 `{nickname}` (昵称/名片) 和 `{user_id}` (QQ号)。 |

### 3. 🚫 违禁词过滤
| 配置项 | 说明 |
| :--- | :--- |
| **违禁词列表** | 使用竖线 `|` 分隔，例如 `兼职|刷单|加群`。 |
| **触发惩罚** | 仅撤回 / 撤回+禁言1分钟 / 撤回+踢出。 |

---

## 💻 指令列表

### 🔒 群名片锁定指令

> **机制说明**：
> * 管理员锁定的名片，普通成员无法修改或解锁。
> * 插件会在成员**入群时**、**修改名片时**（需适配器支持事件）以及**发言时**检查名片，发现不一致立即改回。

| 指令格式 | 适用角色 | 说明 |
| :--- | :--- | :--- |
| **/lockname @成员 昵称** | **管理员** | **[最高优先级]** 强制修改并锁定他人名片。 |
| **/lockname 昵称** | **所有人** | 锁定**自己**的名片（如果已被管理员锁定则无法操作）。 |
| **/unlockname @成员** | **管理员** | 解除对他人的名片锁定。 |
| **/unlockname** | **所有人** | 解除**自己**的名片锁定。 |

### ⚡ 常规管理指令 (仅管理员)

| 指令格式 | 说明 |
| :--- | :--- |
| **/kick @成员** | 踢出群成员。 |
| **/ban @成员 [秒数]** | 禁言指定成员（默认 600秒）。 |
| **/unban @成员** | 解除禁言。 |
| **/muteall** | 开启全员禁言。 |
| **/unmuteall** | 关闭全员禁言。 |

---

## ❓ 常见问题

**Q: 为什么修改了名片没有立即变回来？**
A: 部分 OneBot 实现可能不推送“群名片变更”事件。本插件采用了双重检测机制：1. 监听变更事件；2. **发言检测**（成员在修改名片后一旦发言，会立即被检测并改回锁定状态）。

**Q: 后台显示 "No data returned" 报错？**
A: 这是正常的。部分 API（如禁言）执行成功后不返回数据，插件后台日志可能会记录此警告，不影响功能使用。

**Q: 配置文件在哪里？**
A: 配置文件默认保存在 NapCat 的 `data/config.json` 或插件目录下的 `config.json` 中，包含所有配置项和锁定的昵称数据。

---

## 📝 开发信息

* **版本**: 1.1.0
* **适配器**: OneBot 11 (NapCat)
* **语言**: TypeScript